<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración - Reportes de Incidencias</title>
    
    <script>
        const sesion = localStorage.getItem('sesion');
        if (!sesion) {
            window.location.href = "login.html";
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="top-bar">
        <div class="logo-container">
            <div class="logo-placeholder" id="logo-placeholder">
                <i class="fas fa-tools"></i>
            </div>
            <img src="logo sin fondo.png" alt="Logo del Sistema" class="logo-img" onerror="document.getElementById('logo-placeholder').style.display='flex'; this.style.display='none'">            
            <div class="logo-text">
                <h1>Sistema de <span>Incidencias</span></h1>
                <div class="subtitle">Panel de Administración</div>
            </div>
        </div>

        <div class="top-user-info">
            <div class="user-details">
                <span id="display-user-name" style="font-weight: bold; color: var(--primary-blue);">Cargando...</span>
                <small id="display-user-role" style="display: block; color: var(--text-light); font-size: 0.75rem; text-align: right;">...</small>
            </div>
            
            <button id="btn-logout" style="background: var(--accent-color); color: white; margin-left: 15px; padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 600; transition: transform 0.2s;">
                <i class="fas fa-power-off"></i> Salir
            </button>

            <div class="top-user-avatar" data-tooltip="Usuario">AD</div>
        </div>
    </div>

    <div class="container">
        <aside class="sidebar">
            <div class="logo-sidebar">
                <h2>Admin<span>Incidencias</span></h2>
                <p>Sistema de Gestión</p>
            </div>
            <ul class="menu">
                <li class="menu-item">
                    <a href="#" class="menu-link active" id="nav-dashboard">
                        <i class="fas fa-chart-line"></i>
                        <span>Dashboard</span>
                        <span class="notification-badge">3</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="registro_usuario.html" style="display: flex; align-items: center; padding: 12px 15px; color: rgba(255, 255, 255, 0.85); text-decoration: none; border-radius: 8px; transition: all 0.3s ease; position: relative; overflow: hidden;" onmouseover="this.style.backgroundColor='rgba(255, 255, 255, 0.1)'; this.style.color='#ffffff'; this.style.transform='translateX(5px)'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='rgba(255, 255, 255, 0.85)'; this.style.transform='translateX(0)'">
                        <i class="fas fa-user-plus" style="margin-right: 12px; font-size: 1.1rem; color: #AB096A; min-width: 24px; text-align: center;"></i>
                        <span>Registro Usuarios</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" id="nav-incidencias">
                        <i class="fas fa-exclamation-circle"></i>
                        <span>Incidencias</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" id="nav-tecnicos">
                        <i class="fas fa-users"></i>
                        <span>Técnicos</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" id="nav-empresas">
                        <i class="fas fa-building"></i>
                        <span>Empresas</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link" id="nav-reportes">
                        <i class="fas fa-file-export"></i>
                        <span>Reportes</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            
            <div id="view-dashboard">
                <h1 class="page-title">
                    <i class="fas fa-chart-bar"></i>
                    Reportes de Incidencias
                </h1>

                <section class="filters">
                    <h2><i class="fas fa-filter"></i> Filtrar Reporte</h2>
                    <div class="filter-grid">
                        <div class="filter-group">
                            <label for="empresa"><i class="fas fa-building"></i> Empresa</label>
                            <select id="empresa" class="filter-control">
                                <option value="">Todas las empresas</option>
                                <option value="zoxo">Zoxo</option>
                                <option value="codiversa">Codiversa</option>
                                <option value="copesa">Copesa</option>
                                <option value="sitraq">Sitraq</option>
                                <option value="corevsa">Corevsa</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="tecnico"><i class="fas fa-user-cog"></i> Técnico</label>
                            <select id="tecnico" class="filter-control">
                                <option value="">Todos los técnicos</option>                       
                                <option value="juan_perez">Juan Pérez</option>
                                <option value="maria_gomez">María Gómez</option>
                                <option value="carlos_rodriguez">Carlos Rodríguez</option>
                                <option value="ana_lopez">Ana López</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="tipo-falla"><i class="fas fa-tools"></i> Tipo de Falla</label>
                            <select id="tipo-falla" class="filter-control">
                                <option value="">Todos los tipos</option>
                                <option value="equipos">Equipos</option>
                                <option value="elementos">Elementos</option>
                                <option value="accesorios">Accesorios</option>
                                <option value="conexion">Conexión/Internet</option>
                                <option value="configuracion">Configuración</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="estado"><i class="fas fa-clipboard-check"></i> Estado</label>
                            <select id="estado" class="filter-control">
                                <option value="">Todos los estados</option>
                                <option value="abierto">Abierto</option>
                                <option value="espera">En Espera</option>
                                <option value="cerrado">Cerrado</option>
                                <option value="resuelto">Resuelto</option>
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="fecha-inicio"><i class="fas fa-calendar-alt"></i> Rango de Fechas</label>
                            <div class="date-range">
                                <input type="date" id="fecha-inicio" class="filter-control" style="flex: 1;" data-tooltip="Fecha inicial">
                                <input type="date" id="fecha-fin" class="filter-control" style="flex: 1;" data-tooltip="Fecha final">
                            </div>
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button class="btn btn-secondary" id="limpiar-filtros" data-tooltip="Restablecer filtros">
                            <i class="fas fa-eraser"></i> Limpiar Filtros
                        </button>
                        <button class="btn btn-pdf" id="generar-pdf" data-tooltip="Ver vista previa">
                            <i class="fas fa-file-pdf"></i> Vista Previa PDF
                        </button>
                    </div>
                </section>

                <section class="data-summary">
                    <div class="summary-card">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3 id="total-incidencias">48</h3>
                        <p>Incidencias Totales</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-user-cog"></i>
                        <h3>12</h3>
                        <p>Técnicos Activos</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-building"></i>
                        <h3>5</h3>
                        <p>Empresas</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-folder-open"></i>
                        <h3 id="abiertas-count">15</h3>
                        <p>Incidencias Abiertas</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-hourglass-half"></i>
                        <h3 id="espera-count">8</h3>
                        <p>En Espera de Refacción</p>
                    </div>
                    <div class="summary-card">
                        <i class="fas fa-check-circle"></i>
                        <h3 id="cerradas-count">25</h3>
                        <p>Incidencias Cerradas</p>
                    </div>
                </section>

                <section class="table-preview">
                    <h2><i class="fas fa-table"></i> Vista Previa del Reporte</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Técnico</th>
                                <th>Fecha</th>
                                <th>Empresa</th>
                                <th>Tiempo</th>
                                <th>Tipo de Falla</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tickets-body">
                            </tbody>
                    </table>
                </section>
            </div>

            <div id="view-incidencias" style="display: none;">
                <h1 class="page-title">
                    <i class="fas fa-exclamation-circle"></i>
                    Todas las Incidencias
                </h1>
                <div class="table-preview">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Técnico</th>
                                <th>Empresa</th>
                                <th>Tipo de Falla</th>
                                <th>Fecha</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="all-tickets-body">
                            </tbody>
                    </table>
                </div>
            </div>

            <div id="view-tecnicos" style="display: none;">
                <h1 class="page-title">
                    <i class="fas fa-users"></i>
                    Listado de Técnicos
                </h1>
                <div class="data-summary" id="tecnicos-list-container" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
                    </div>
            </div>

            <div id="view-empresas" style="display: none;">
                <h1 class="page-title">
                    <i class="fas fa-building"></i>
                    Empresas Registradas
                </h1>
                <div class="data-summary" id="empresas-list-container" style="grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));">
                    </div>
            </div>

            <div id="view-reportes" style="display: none;">
                <h1 class="page-title">
                    <i class="fas fa-file-export"></i>
                    Historial de Reportes
                </h1>
                <div class="table-preview">
                    <table>
                        <thead>
                            <tr>
                                <th>Nombre del Reporte</th>
                                <th>Fecha Generación</th>
                                <th>Periodo Analizado</th>
                                <th>Usuario Generador</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="reportes-history-body">
                            </tbody>
                    </table>
                </div>
            </div>

        </main>
    </div>

    <div class="modal" id="pdf-preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-file-pdf"></i> Vista Previa del Reporte PDF</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="btn-descargar-final">
                        <i class="fas fa-download"></i> Descargar Reporte
                    </button>
                    <button class="close-modal" id="close-modal">&times;</button>
                </div>
            </div>
            <div id="pdf-content">
                </div>
        </div>
    </div>

    <script src="Administrador.js"></script>
</body>       
</html>